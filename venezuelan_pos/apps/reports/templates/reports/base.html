{% extends "events/base.html" %}
{% load static %}

{% block extra_css %}
    {{ block.super }}
    <link href="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/datatables.net-bs5@1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet">
    <style>
        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .metric-card:hover {
            transform: translateY(-5px);
        }
        
        .metric-card.revenue {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }
        
        .metric-card.transactions {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .metric-card.tickets {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        .metric-card.performance {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        
        .metric-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .metric-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 1.5rem;
        }
        
        .heat-map-container {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            overflow-x: auto;
        }
        
        .heat-map-seat {
            width: 30px;
            height: 30px;
            margin: 2px;
            border-radius: 4px;
            display: inline-block;
            text-align: center;
            line-height: 30px;
            font-size: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .heat-map-seat:hover {
            transform: scale(1.2);
            z-index: 10;
            position: relative;
        }
        
        .heat-map-seat.available {
            background-color: #e8f5e8;
            color: #2d5a2d;
            border: 1px solid #4caf50;
        }
        
        .heat-map-seat.sold {
            background-color: #ffebee;
            color: #c62828;
            border: 1px solid #f44336;
        }
        
        .heat-map-seat.reserved {
            background-color: #fff3e0;
            color: #ef6c00;
            border: 1px solid #ff9800;
        }
        
        .heat-map-legend {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 1rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
        
        .filter-panel {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 1.5rem;
        }
        
        .report-card {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 1rem;
            transition: transform 0.3s ease;
        }
        
        .report-card:hover {
            transform: translateY(-2px);
        }
        
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .status-completed {
            background-color: #d4edda;
            color: #155724;
        }
        
        .status-generating {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .status-failed {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .performance-grade {
            font-size: 1.5rem;
            font-weight: bold;
            padding: 0.5rem 1rem;
            border-radius: 50%;
            display: inline-block;
            text-align: center;
            min-width: 50px;
        }
        
        .grade-a { background: #4caf50; color: white; }
        .grade-b { background: #8bc34a; color: white; }
        .grade-c { background: #ffeb3b; color: #333; }
        .grade-d { background: #ff9800; color: white; }
        .grade-f { background: #f44336; color: white; }
        
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .real-time-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #4caf50;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .drag-drop-area {
            border: 2px dashed #ccc;
            border-radius: 10px;
            padding: 2rem;
            text-align: center;
            background: #f8f9fa;
            transition: all 0.3s ease;
        }
        
        .drag-drop-area.dragover {
            border-color: #007bff;
            background: #e3f2fd;
        }
        
        .filter-chip {
            display: inline-block;
            background: #e3f2fd;
            color: #1976d2;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            margin: 0.25rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .filter-chip:hover {
            background: #1976d2;
            color: white;
        }
        
        .filter-chip.active {
            background: #1976d2;
            color: white;
        }
    </style>
{% endblock %}

{% block extra_js %}
    {{ block.super }}
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/datatables.net@1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/datatables.net-bs5@1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <script>
        // Global chart configuration
        Chart.defaults.font.family = "'Inter', sans-serif";
        Chart.defaults.color = '#6c757d';
        
        // Utility functions for reports
        window.ReportsUtils = {
            formatCurrency: function(amount) {
                return new Intl.NumberFormat('es-VE', {
                    style: 'currency',
                    currency: 'USD'
                }).format(amount);
            },
            
            formatNumber: function(number) {
                return new Intl.NumberFormat('es-VE').format(number);
            },
            
            formatPercentage: function(percentage) {
                return new Intl.NumberFormat('es-VE', {
                    style: 'percent',
                    minimumFractionDigits: 1,
                    maximumFractionDigits: 1
                }).format(percentage / 100);
            },
            
            getPerformanceGradeClass: function(grade) {
                const gradeMap = {
                    'A+': 'grade-a', 'A': 'grade-a',
                    'B+': 'grade-b', 'B': 'grade-b',
                    'C+': 'grade-c', 'C': 'grade-c',
                    'D+': 'grade-d', 'D': 'grade-d',
                    'F': 'grade-f'
                };
                return gradeMap[grade] || 'grade-f';
            },
            
            showLoading: function(element) {
                element.html('<div class="text-center"><div class="loading-spinner"></div> Cargando...</div>');
            },
            
            hideLoading: function(element) {
                element.find('.loading-spinner').parent().remove();
            }
        };
        
        // Real-time updates
        window.RealTimeUpdates = {
            interval: null,
            
            start: function(callback, intervalMs = 30000) {
                this.stop(); // Clear any existing interval
                this.interval = setInterval(callback, intervalMs);
                callback(); // Run immediately
            },
            
            stop: function() {
                if (this.interval) {
                    clearInterval(this.interval);
                    this.interval = null;
                }
            }
        };
        
        // Initialize DataTables with Spanish localization
        $(document).ready(function() {
            $('.data-table').DataTable({
                language: {
                    url: 'https://cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json'
                },
                responsive: true,
                pageLength: 25,
                order: [[0, 'desc']]
            });
        });
    </script>
{% endblock %}